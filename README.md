# Data product visualisation


## Web Map Service

The analysed field generated by DIVA (Data-Interpolating Variational Analysis) can be visualised using the WMS protocol which supports the following requests:

* GetCapabilities

This request is used to provide all layers of the map server. To every parameter and to every region corresponds a different WMS layer. An example of such a request would be:

http://ec.oceanbrowser.net/emodnet/Python/web/wms?request=GetCapabilities&service=WMS&version=1.3.0

* GetMap

This request allows to extract a horizontal section of the 4D NetCDF file at the specified depth and time ([Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms?LAYERS=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.0506927%2Bvmax%3A6%2Bncontours%3A40&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&ELEVATION=-0.0&TIME=2000&SRS=EPSG%3A4326&BBOX=0,45,45,90&WIDTH=512&HEIGHT=512)).

![WMS](http://ec.oceanbrowser.net/emodnet/Python/web/wms?LAYERS=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.0506927%2Bvmax%3A6%2Bncontours%3A40&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&ELEVATION=-0.0&TIME=2000&SRS=EPSG%3A4326&BBOX=0,45,45,90&WIDTH=512&HEIGHT=512)


Per default, the axis are not displayed on a map. This can be activated by setting the parameter `DECORATED` to `true` ([Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms?LAYERS=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.0506927%2Bvmax%3A6%2Bncontours%3A40&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&ELEVATION=-0.0&TIME=2000&SRS=EPSG%3A4326&BBOX=0,45,45,90&WIDTH=512&HEIGHT=512&decorated=true)).

![Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms?LAYERS=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.0506927%2Bvmax%3A6%2Bncontours%3A40&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&ELEVATION=-0.0&TIME=2000&SRS=EPSG%3A4326&BBOX=0,45,45,90&WIDTH=512&HEIGHT=512&decorated=true)

The GetMap can also be used to extract a vertical section ([Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms_vert?LAYERS=Baltic%20Sea%2FWinter%20(December-February)%20-%2010-years%20running%20averages%2FWater_body_phosphate.4Danl.nc*Water_body_phosphate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.454701439302%2Bvmax%3A3.72072045395%2Bncontours%3A40&FORMAT=image%2Fpng&TRANSPARENT=true&RATIO=0.017138400059101652&SECTION=13.909765625%2C55.05546875%7C17.6890625%2C56.11015625%7C20.237890625%2C57.86796875%7C21.2046875%2C59.0984375%7C23.13828125%2C59.62578125%7C25.687109375%2C59.97734375%7C27.269140625%2C59.97734375&TIME=2000&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS=EPSG%3A4326&BBOX=246.70377315774,-131.8490736905,370.05565973661,-8.4971871116268&WIDTH=256&HEIGHT=256)). The path of the section is encoded in the `SECTION` parameter: the longitude and latitude are separated by a comma and the coordinates by the pipe-symbol (`|`). The x-axis corresponds to the distance in arc degrees along the section (the first point is the origin) and the y-axis in the depth in meters. The parameter `RATIO` defines the aspect ratio of the vertical section.

![Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms_vert?LAYERS=Baltic%20Sea%2FWinter%20(December-February)%20-%2010-years%20running%20averages%2FWater_body_phosphate.4Danl.nc*Water_body_phosphate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.454701439302%2Bvmax%3A3.72072045395%2Bncontours%3A40&FORMAT=image%2Fpng&TRANSPARENT=true&RATIO=0.017138400059101652&SECTION=13.909765625%2C55.05546875%7C17.6890625%2C56.11015625%7C20.237890625%2C57.86796875%7C21.2046875%2C59.0984375%7C23.13828125%2C59.62578125%7C25.687109375%2C59.97734375%7C27.269140625%2C59.97734375&TIME=2000&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS=EPSG%3A4326&BBOX=246.70377315774,-131.8490736905,370.05565973661,-8.4971871116268&WIDTH=512&HEIGHT=256&decorated=true)

Images can be returned in raster (PNG) and vector image formats (SVG, EPS, PDF). They can also be saved as a KML file so that the current layer can be visualized in programs like Google Earth and combined with other information imported in such programs.
By providing multiple time instances, the web map server can also return animation in the WebM or MP4 format using this GetMap request ([Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms?&layers=Baltic%20Sea%2FWinter%20(December-February)%20-%2010-years%20running%20averages%2FWater_body_phosphate.4Danl.nc*Water_body_phosphate&request=GetMap&width=800&height=500&bbox=9.164351%2C52.393448%2C31.07109%2C66.763566&transparent=true&decorated=true&crs=CRS%3A84&version=1.3.0&styles=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0%2Bvmax%3A1.35%2Bncontours%3A40&format=video%2Fmp4&elevation=-0.0&time=1965%2C1966%2C1967%2C1968%2C1969%2C1970%2C1971%2C1972%2C1973%2C1974%2C1975%2C1976%2C1977%2C1978%2C1979%2C1980%2C1981%2C1982%2C1983%2C1984%2C1985%2C1986%2C1987%2C1988%2C1989%2C1990%2C1991%2C1992%2C1993%2C1994%2C1995%2C1996%2C1997%2C1998%2C1999%2C2000%2C2001%2C2002%2C2003%2C2004%2C2005%2C2006%2C2007%2C2008%2C2009%2C2010&title=Water_body_phosphate%0Adepth%3A%20-0.0%20meters&basemap=shadedrelief&rate=2)). As the animation are generated dynamically, it usually takes a couple of minutes to create them. The frame rate of the animation is controlled through the parameter rate.


* GetFeatureInfo

This request returns a simple XML file with the underlying value of the analysed field ([Example URL](http://ec.oceanbrowser.net/emodnet/Python/web/wms?LAYERS=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&STYLES=cmap%3Ajet%2Binverted%3Afalse%2Bmethod%3Apcolor_flat%2Bvmin%3A0.0506927%2Bvmax%3A6%2Bncontours%3A40&TRANSPARENT=true&FORMAT=image%2Fpng&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&ELEVATION=-0.0&TIME=2000&SRS=EPSG%3A4326&EXCEPTIONS=application%2Fvnd.ogc.se_xml&BBOX=-59.65332%2C12.353516%2C79.65332%2C72.646484&X=895&Y=146&INFO_FORMAT=application%2Fvnd.ogc.gml&QUERY_layers=Baltic%20Sea%2FAutumn%20(September-November)%20-%2010-years%20running%20averages%2FWater_body_nitrate.4Danl.nc*Water_body_nitrate_L2&WIDTH=1585&HEIGHT=686&)). 

However, the WMS standards (in version 1.1.1 and 1.3.0) is not completely adequate for ocean analyses. A WMS allows to represent a data set according a list of different styles. A legend is attributed to each style which for scalar is colorbar. The legend for a given style is represented by a link to an image.

A single legend is used for entire data set (for all depth layers and time instances in particular). However the ocean is strongly stratified and unique legend does not provide sufficient contrast because the ocean properties at depth are often very different from the properties near the surface. The solution is to make the legend dynamic so that it can be adjusted based on a range of value at a specified depth and time

## OPENDAP

OPENDAP allows to download and subset gridded datasets. The OPENDAP product is nowadays included in the NetCDF library so that most programms able to read NetCDF files can also access remote datasets over OPENDAP and downloading only the actual required data subset.

An [Jupyter notebook](src/EMODNET-chemistry.ipynb) illustrates the use of an EMODNET Chemistry product using OPENDAP. To run this example, it is necessary to install the following (free) software packages:

* Julia available from https://julialang.org/downloads/. The code is tested with the version 0.6 of Julia.
* Some Julia packages (NCDatasets, PyPlot and IJulia), which can be installed with these commands once you started Julia:

```julia
Pkg.add("NCDatasets.jl")
Pkg.add("PyPlot")
Pkg.add("IJulia")
```
